from dataloaders import RenderedDataLoader
import pytorch_lightning as pl
from torch.utils.data import DataLoader
import models
from pytorch_lightning.callbacks import ModelCheckpoint, StochasticWeightAveraging, BaseFinetuning
import inference
import warnings
from pytorch_lightning import loggers as pl_loggers

class FeatureExtractorFreezeUnfreeze(BaseFinetuning):
     def __init__(self, unfreeze_at_epoch=100):
         super().__init__()
         self._unfreeze_at_epoch = unfreeze_at_epoch

     def freeze_before_training(self, pl_module):
         # freeze any module you want
         # Here, we are freezing `feature_extractor`
         self.freeze(pl_module.swav)

     def finetune_function(self, pl_module, current_epoch, optimizer, optimizer_idx):
         # When `current_epoch` is 10, feature_extractor will start training.
         if current_epoch == self._unfreeze_at_epoch:
             self.unfreeze_and_add_param_group(
                 modules=pl_module.swav,
                 optimizer=optimizer,
                 train_bn=True,
             )


def unified_training(class_key,
                    chm_mean,
                    chm_std,
                    base_lr,
                    refine_lr,
                    height_threshold,
                    class_weights,
                    trained_backbone,
                    features_dict,
                    num_intermediate_classes,
                    pre_train_folder,
                    train_folder,
                    valid_folder,
                    test_folder,
                    pre_training_epochs,
                    refine_epochs,
                    pre_train_batch_size,
                    refine_batch_size,
                    pre_train_workers,
                    refine_workers,
                    log_dir,
                    swa=False,
                    extra_labels="",
                    pre_training=True,
                    mode='default',
                    augment_refine=False,
                    scheduler=True, 
                    initial_freeze=None):

    pl.seed_everything(42)
    feature_labels = ""
    for key, value in features_dict.items():
        feature_labels = feature_labels + f"{key}_{value}_"

    refine_callback = ModelCheckpoint(
        dirpath='ckpts/unified_training', 
        filename=f'niwo_refine_{feature_labels}{extra_labels}'+'{ova:.2f}_{epoch}',
        #every_n_epochs=log_every,
        monitor='ova',
        save_on_train_epoch_end=True,
        mode='max',
        save_top_k = 3
        )

    pre_train_callback = ModelCheckpoint(
        dirpath='ckpts/unified_training', 
        filename=f'niwo_pre_train_{feature_labels}{extra_labels}'+'{epoch}',
        every_n_epochs=pre_training_epochs,
        save_on_train_epoch_end=True,
        save_top_k = -1
        )
    
    
    pre_train_ckpt = f'ckpts/unified_training/niwo_pre_train_{feature_labels}{extra_labels}epoch={pre_training_epochs-1}.ckpt'

    pre_model = models.SwaVModelUnified(class_key,
                                    chm_mean,
                                    chm_std,
                                    base_lr,
                                    height_threshold,
                                    class_weights,
                                    trained_backbone,
                                    features_dict,
                                    num_intermediate_classes,
                                    pre_training=True,
                                    mode=mode,
                                    augment_refine=augment_refine,
                                    scheduler=scheduler
                                   )

    pre_train_data = RenderedDataLoader(pre_train_folder)
    pre_train_loader = DataLoader(pre_train_data, batch_size=pre_train_batch_size, num_workers=pre_train_workers, pin_memory=True)

    train_dataset = RenderedDataLoader(train_folder)
    train_loader = DataLoader(train_dataset, batch_size=refine_batch_size, num_workers=refine_workers)

    valid_dataset = RenderedDataLoader(valid_folder)
    valid_loader = DataLoader(valid_dataset, batch_size=1, num_workers=refine_workers)

    test_dataset = RenderedDataLoader(test_folder)
    test_loader = DataLoader(test_dataset, batch_size=1, num_workers=refine_workers)

    tb_logger = pl_loggers.TensorBoardLogger(save_dir=log_dir)

    if pre_training:
        pre_trainer = pl.Trainer(accelerator="gpu", max_epochs=pre_training_epochs, callbacks=[pre_train_callback], logger=tb_logger)
        
        pre_trainer.fit(pre_model, pre_train_loader)

    refine_callbacks = [refine_callback]

    if swa:
        refine_callbacks.append(StochasticWeightAveraging(swa_epoch_start=350))

    if initial_freeze is not None:
        refine_callbacks.append(FeatureExtractorFreezeUnfreeze(initial_freeze))

    

    refiner = pl.Trainer(accelerator="gpu", max_epochs=refine_epochs, callbacks=refine_callbacks, logger=tb_logger, log_every_n_steps=1)

    refine_model = models.SwaVModelUnified.load_from_checkpoint(pre_train_ckpt, 
                                                                pre_training=False, 
                                                                mode=mode, 
                                                                lr=refine_lr,
                                                                augment_refine=augment_refine,
                                                                scheduler=scheduler)
    refiner.fit(refine_model, train_dataloaders=train_loader, val_dataloaders=valid_loader)
    refiner.test(ckpt_path='best', dataloaders=test_loader)
    

if __name__ == "__main__":



    unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
                    chm_mean=4.015508459469479,
                    chm_std=4.809300736115787,
                    base_lr=5e-4,
                    refine_lr=5e-5,
                    height_threshold=5,
                    class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
                    trained_backbone=True,
                    features_dict={
                        'pca' : 3,
                        'ica': 3,
                        'raw_bands': 15,
                    },
                    num_intermediate_classes = 256,
                    pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
                    train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
                    valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
                    test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
                    pre_training_epochs = 15,
                    refine_epochs = 600,
                    pre_train_batch_size = 2048,
                    refine_batch_size = 64,
                    pre_train_workers = 8,
                    refine_workers = 1,
                    log_dir='exp_logs/',
                    pre_training=False,
                    extra_labels='small_mlp_large_transformer_',
                    swa=True,
                    mode='default',
                    scheduler=True,
                    initial_freeze=300)
    
    unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
                    chm_mean=4.015508459469479,
                    chm_std=4.809300736115787,
                    base_lr=5e-4,
                    refine_lr=5e-5,
                    height_threshold=5,
                    class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
                    trained_backbone=True,
                    features_dict={
                        'pca' : 3,
                        'ica': 3,
                        'raw_bands': 15,
                    },
                    num_intermediate_classes = 256,
                    pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
                    train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
                    valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
                    test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
                    pre_training_epochs = 15,
                    refine_epochs = 600,
                    pre_train_batch_size = 2048,
                    refine_batch_size = 64,
                    pre_train_workers = 8,
                    refine_workers = 1,
                    log_dir='exp_logs/',
                    pre_training=False,
                    extra_labels='small_mlp_large_transformer_no_freeze',
                    swa=True,
                    mode='default',
                    scheduler=True,
                    initial_freeze=None)

    unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
                    chm_mean=4.015508459469479,
                    chm_std=4.809300736115787,
                    base_lr=5e-4,
                    refine_lr=5e-5,
                    height_threshold=5,
                    class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
                    trained_backbone=True,
                    features_dict={
                        'pca' : 3,
                        'ica': 3,
                        'raw_bands': 15,
                    },
                    num_intermediate_classes = 512,
                    pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
                    train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
                    valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
                    test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
                    pre_training_epochs = 15,
                    refine_epochs = 600,
                    pre_train_batch_size = 2048,
                    refine_batch_size = 64,
                    pre_train_workers = 8,
                    refine_workers = 1,
                    log_dir='exp_logs/',
                    pre_training=True,
                    extra_labels='small_mlp_large_transformer_512_classes',
                    swa=True,
                    mode='default',
                    scheduler=True,
                    initial_freeze=300)
    
    unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
                    chm_mean=4.015508459469479,
                    chm_std=4.809300736115787,
                    base_lr=5e-4,
                    refine_lr=5e-5,
                    height_threshold=5,
                    class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
                    trained_backbone=True,
                    features_dict={
                        'pca' : 3,
                        'ica': 3,
                        'raw_bands': 15,
                    },
                    num_intermediate_classes = 8,
                    pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
                    train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
                    valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
                    test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
                    pre_training_epochs = 15,
                    refine_epochs = 600,
                    pre_train_batch_size = 2048,
                    refine_batch_size = 64,
                    pre_train_workers = 8,
                    refine_workers = 1,
                    log_dir='exp_logs/',
                    pre_training=True,
                    extra_labels='small_mlp_large_transformer_8_classes_',
                    swa=True,
                    mode='default',
                    scheduler=True,
                    initial_freeze=300)


    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15,
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 400,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_batch_size_64_swa',
    #                 swa=True)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_swa_',
    #                 swa=True)

    

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=None,
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_no_class_weights',
    #                 )

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_no_schedule_',
    #                 augment_refine=False,
    #                 scheduler=False)
                    
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_augment_',
    #                 augment_refine=True)
    
    

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_no_schedule_augment',
    #                 augment_refine=True,
    #                 scheduler=False)

    

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'azm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'shadow': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')


# #ICA
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')
                    
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'azm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'shadow': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')
# #RAW

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')
                    
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'azm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'shadow': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')


# #COMBOS
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'ica': 10,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_') 

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica': 10,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'ica': 10,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'ica': 3,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'ica': 3,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')     

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica': 3,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')      

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_') 

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'ica': 10,
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1,
#                         'shadow': 1
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')   
    
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'ica': 3,
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1,
#                         'shadow': 1
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')   