from dataloaders import RenderedDataLoader
import pytorch_lightning as pl
from torch.utils.data import DataLoader
import models
from pytorch_lightning.callbacks import ModelCheckpoint, StochasticWeightAveraging, BaseFinetuning
import inference
import warnings
import os
from pytorch_lightning import loggers as pl_loggers
from einops import rearrange
import matplotlib.pyplot as plt

class FeatureExtractorFreezeUnfreeze(BaseFinetuning):
     def __init__(self, unfreeze_at_epoch=100):
         super().__init__()
         self._unfreeze_at_epoch = unfreeze_at_epoch

     def freeze_before_training(self, pl_module):
         # freeze any module you want
         # Here, we are freezing `feature_extractor`
         self.freeze(pl_module.swav)

     def finetune_function(self, pl_module, current_epoch, optimizer, optimizer_idx):
         # When `current_epoch` is 10, feature_extractor will start training.
         if current_epoch == self._unfreeze_at_epoch:
             self.unfreeze_and_add_param_group(
                 modules=pl_module.swav,
                 optimizer=optimizer,
                 train_bn=True,
                 lr=5e-5
             )


def unified_training(class_key,
                    chm_mean,
                    chm_std,
                    base_lr,
                    refine_lr,
                    height_threshold,
                    class_weights,
                    features_dict,
                    num_intermediate_classes,
                    pre_train_folder,
                    train_folder,
                    valid_folder,
                    test_folder,
                    pre_training_epochs,
                    refine_epochs,
                    pre_train_batch_size,
                    refine_batch_size,
                    pre_train_workers,
                    refine_workers,
                    log_dir,
                    swa=False,
                    extra_labels="",
                    pre_training=True,
                    mode='default',
                    augment_refine=False,
                    scheduler=True, 
                    initial_freeze=None,
                    height_mask=False,
                    positions=False,
                    input_size=40,
                    full_plots=True,
                    acc_grad=1,
                    emb_size=256,
                    scaling=True,
                    augment_bright=False,
                    filters=[]):

    pl.seed_everything(42)
    feature_labels = ""
    for key, value in features_dict.items():
        feature_labels = feature_labels + f"{key}_{value}_"

    refine_callback = ModelCheckpoint(
        dirpath='ckpts/', 
        filename=f'niwo_refine_{feature_labels}{extra_labels}'+'{ova:.2f}_{epoch}',
        #every_n_epochs=log_every,
        monitor='ova',
        save_on_train_epoch_end=True,
        mode='max',
        save_top_k = 3
        )

    pre_train_callback = ModelCheckpoint(
        dirpath='ckpts/', 
        filename=f'niwo_pre_train_{feature_labels}{extra_labels}'+'{epoch}',
        every_n_epochs=pre_training_epochs,
        save_on_train_epoch_end=True,
        save_top_k = -1
        )
    
    
    pre_train_ckpt = f'ckpts/niwo_pre_train_{feature_labels}{extra_labels}epoch={pre_training_epochs-1}.ckpt'

    pre_model = models.SwaVModelUnified(class_key,
                                    chm_mean,
                                    chm_std,
                                    base_lr,
                                    height_threshold,
                                    class_weights,
                                    features_dict,
                                    num_intermediate_classes,
                                    pre_training=True,
                                    mode=mode,
                                    augment_refine=augment_refine,
                                    scheduler=scheduler,
                                    positions=positions,
                                    emb_size=emb_size,
                                    filters=filters
                                   )


    if pre_training:
        pre_train_data = RenderedDataLoader(pre_train_folder, features_dict, input_size=input_size)
        pre_train_loader = DataLoader(pre_train_data, batch_size=pre_train_batch_size, num_workers=pre_train_workers, pin_memory=True)

    train_dataset = RenderedDataLoader(train_folder, features_dict, stats_loc=os.path.join(pre_train_folder, 'stats/stats.npy'), input_size=input_size, full_plots=full_plots, scaling=scaling)
    train_loader = DataLoader(train_dataset, batch_size=refine_batch_size, num_workers=refine_workers)

    valid_dataset = RenderedDataLoader(valid_folder, features_dict, stats_loc=os.path.join(pre_train_folder, 'stats/stats.npy'), input_size=input_size, full_plots=full_plots, scaling=scaling)
    valid_loader = DataLoader(valid_dataset, batch_size=1, num_workers=refine_workers)

    test_dataset = RenderedDataLoader(test_folder, features_dict, stats_loc=os.path.join(pre_train_folder, 'stats/stats.npy'), input_size=input_size, full_plots=full_plots, scaling=scaling)
    test_loader = DataLoader(test_dataset, batch_size=1, num_workers=refine_workers)

    tb_logger = pl_loggers.TensorBoardLogger(save_dir=log_dir)

    if pre_training:
        pre_trainer = pl.Trainer(accelerator="gpu", max_epochs=pre_training_epochs, callbacks=[pre_train_callback], logger=tb_logger)
        
        pre_trainer.fit(pre_model, pre_train_loader)

    refine_callbacks = [refine_callback]

    if swa is not None:
        refine_callbacks.append(StochasticWeightAveraging(swa_epoch_start=swa))

    if initial_freeze is not None:
        refine_callbacks.append(FeatureExtractorFreezeUnfreeze(initial_freeze))

    

    refiner = pl.Trainer(accelerator="gpu", max_epochs=refine_epochs, callbacks=refine_callbacks, logger=tb_logger, log_every_n_steps=1, accumulate_grad_batches=acc_grad)

    if pre_training_epochs > 0:
        refine_model = models.SwaVModelUnified.load_from_checkpoint(pre_train_ckpt, 
                                                                    pre_training=False, 
                                                                    mode=mode, 
                                                                    lr=refine_lr,
                                                                    augment_refine=augment_refine,
                                                                    scheduler=scheduler,
                                                                    height_mask=height_mask,
                                                                    emb_size=emb_size)
    else:
         refine_model = models.SwaVModelUnified(class_key,
                                    chm_mean,
                                    chm_std,
                                    refine_lr,
                                    height_threshold,
                                    class_weights,
                                    features_dict,
                                    num_intermediate_classes,
                                    pre_training=False,
                                    mode=mode,
                                    augment_refine=augment_refine,
                                    scheduler=scheduler,
                                    height_mask=height_mask,
                                    positions=positions,
                                    emb_size=emb_size,
                                    augment_bright=augment_bright,
                                    filters=filters
                                   )
    refiner.fit(refine_model, train_dataloaders=train_loader, val_dataloaders=valid_loader)
    refiner.save_checkpoint(f'ckpts/niwo_{feature_labels}{extra_labels}_{refine_epochs}'+'.ckpt')
    refiner.test(refine_model, dataloaders=test_loader, ckpt_path='best')




if __name__ == "__main__":

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 #class_weights=[0.65697674, 0.72435897, 1.4125,     2.56818182],
    #                 class_weights=None,
    #                 features_dict={
    #                     'hs': 416
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/raw_training',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_train_hs',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_valid_hs',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_test_hs',
    #                 pre_training_epochs = 0,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 64,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 4,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='hs_sp_filter',
    #                 swa=150,
    #                 mode='patch',
    #                 scheduler=True,
    #                 initial_freeze=None,
    #                 height_mask=False,
    #                 positions=True,
    #                 emb_size=512,
    #                 scaling=False,
    #                 augment_bright=False,
    #                 filters=['ndvi', 'shadow'])

 
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 #class_weights=[0.65697674, 0.72435897, 1.4125,     2.56818182],
    #                 class_weights=None,
    #                 features_dict={
    #                     'pca': 16
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/raw_training',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_train',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_test',
    #                 pre_training_epochs = 0,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 64,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 4,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='pca_sp_filter',
    #                 swa=150,
    #                 mode='patch',
    #                 scheduler=True,
    #                 initial_freeze=None,
    #                 height_mask=False,
    #                 positions=True,
    #                 emb_size=512,
    #                 scaling=True,
    #                 augment_bright=False,
    #                 filters=['ndvi', 'shadow'])

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 #class_weights=[0.58529412, 0.77734375, 4.52272727, 1.27564103],
    #                 class_weights=None,
    #                 features_dict={
    #                     'pca': 16
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/raw_training',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/scholl_train',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/scholl_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/scholl_test',
    #                 pre_training_epochs = 0,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 64,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 4,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='pca_scholl_filter',
    #                 swa=150,
    #                 mode='patch',
    #                 scheduler=True,
    #                 initial_freeze=None,
    #                 height_mask=False,
    #                 positions=True,
    #                 emb_size=512,
    #                 scaling=True,
    #                 augment_bright=False,
    #                 filters=['ndvi', 'shadow'])


    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 #class_weights=[0.65697674, 0.72435897, 1.4125,     2.56818182],
    #                 class_weights=None,
    #                 features_dict={
    #                     'hs': 416
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_train_hs',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_train_hs',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_valid_hs',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_test_hs',
    #                 pre_training_epochs = 200,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 64,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 4,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=True,
    #                 extra_labels='hs_sp_filter_pre',
    #                 swa=150,
    #                 mode='patch',
    #                 scheduler=True,
    #                 initial_freeze=None,
    #                 height_mask=False,
    #                 positions=True,
    #                 emb_size=512,
    #                 scaling=False,
    #                 augment_bright=False,
    #                 filters=['ndvi', 'shadow'])

 
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 #class_weights=[0.65697674, 0.72435897, 1.4125,     2.56818182],
    #                 class_weights=None,
    #                 features_dict={
    #                     'pca': 16
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/raw_training',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_train',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/sp_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 512,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 4,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='pca_sp_filter_pre',
    #                 swa=None,
    #                 mode='patch',
    #                 scheduler=True,
    #                 initial_freeze=None,
    #                 height_mask=False,
    #                 positions=True,
    #                 emb_size=512,
    #                 scaling=True,
    #                 augment_bright=False,
    #                 filters=['ndvi', 'shadow'])

    unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
                    chm_mean=4.015508459469479,
                    chm_std=4.809300736115787,
                    base_lr=5e-5,
                    refine_lr=5e-5,
                    height_threshold=5,
                    #class_weights=[0.58529412, 0.77734375, 4.52272727, 1.27564103],
                    class_weights=None,
                    features_dict={
                        'pca': 16
                    },
                    num_intermediate_classes = 256,
                    pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/raw_training',
                    train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/scholl_train',
                    valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/scholl_valid',
                    test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_blocks/scholl_test',
                    pre_training_epochs = 15,
                    refine_epochs = 400,
                    pre_train_batch_size = 512,
                    refine_batch_size = 64,
                    pre_train_workers = 4,
                    refine_workers = 1,
                    log_dir='exp_logs/',
                    pre_training=False,
                    extra_labels='pca_scholl_filter_pre',
                    swa=150,
                    mode='patch',
                    scheduler=True,
                    initial_freeze=None,
                    height_mask=False,
                    positions=True,
                    emb_size=512,
                    scaling=True,
                    augment_bright=False,
                    filters=['ndvi', 'shadow'])
                    

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.63888889, 0.73717949, 1.4375, 2.61363636],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'ica': 10,
    #                     'pca':10
    #                    # 'chm': 1
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training_indexes/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='indexes_',
    #                 swa=None,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=None)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-5,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.63888889, 0.73717949, 1.4375, 2.61363636],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'ica': 10,
    #                     'pca':10
    #                    # 'chm': 1
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training_indexes/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 250,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='indexes_',
    #                 swa=None,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=150)


    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca': 10,
    #                     'ica': 10
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training_indexes/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 50,
    #                 refine_epochs = 500,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='indexes_',
    #                 swa=400,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=None)
  
  
    
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca': 10
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training_indexes/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=True,
    #                 extra_labels='indexes_',
    #                 swa=None,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=None)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training_indexes/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=True,
    #                 extra_labels='indexes_',
    #                 swa=None,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=None)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'indexes': 26
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training_indexes/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=True,
    #                 extra_labels='indexes_',
    #                 swa=None,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=None)


    
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15,
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 1500,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='small_mlp_',
    #                 swa=1,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=None)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #             chm_mean=4.015508459469479,
    #             chm_std=4.809300736115787,
    #             base_lr=5e-4,
    #             refine_lr=5e-5,
    #             height_threshold=5,
    #             class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #             trained_backbone=True,
    #             features_dict={
    #                 'pca' : 3,
    #                 'ica': 3,
    #                 'raw_bands': 15,
    #             },
    #             num_intermediate_classes = 256,
    #             pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #             train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #             valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #             test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #             pre_training_epochs = 15,
    #             refine_epochs = 1500,
    #             pre_train_batch_size = 2048,
    #             refine_batch_size = 64,
    #             pre_train_workers = 8,
    #             refine_workers = 1,
    #             log_dir='exp_logs/',
    #             pre_training=False,
    #             extra_labels='small_mlp_',
    #             swa=None,
    #             mode='default',
    #             scheduler=True,
    #             initial_freeze=None)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #             chm_mean=4.015508459469479,
    #             chm_std=4.809300736115787,
    #             base_lr=5e-4,
    #             refine_lr=5e-5,
    #             height_threshold=5,
    #             class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #             trained_backbone=True,
    #             features_dict={
    #                 'pca' : 3,
    #                 'ica': 3,
    #                 'raw_bands': 15,
    #             },
    #             num_intermediate_classes = 256,
    #             pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #             train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #             valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #             test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #             pre_training_epochs = 15,
    #             refine_epochs = 1500,
    #             pre_train_batch_size = 2048,
    #             refine_batch_size = 64,
    #             pre_train_workers = 8,
    #             refine_workers = 1,
    #             log_dir='exp_logs/',
    #             pre_training=False,
    #             extra_labels='small_mlp_',
    #             swa=65,
    #             mode='default',
    #             scheduler=True,
    #             initial_freeze=65)



    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15,
    #                 },
    #                 num_intermediate_classes = 512,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 700,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='small_mlp_512_classes',
    #                 swa=False,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=65)
    
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 base_lr=5e-4,
    #                 refine_lr=5e-5,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15,
    #                 },
    #                 num_intermediate_classes = 8,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 700,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=True,
    #                 extra_labels='small_mlp_8_classes_',
    #                 swa=False,
    #                 mode='default',
    #                 scheduler=True,
    #                 initial_freeze=65)


    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15,
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 400,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 64,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_batch_size_64_swa',
    #                 swa=True)

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_swa_',
    #                 swa=True)

    

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=None,
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_no_class_weights',
    #                 )

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_no_schedule_',
    #                 augment_refine=False,
    #                 scheduler=False)
                    
    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_augment_',
    #                 augment_refine=True)
    
    

    # unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PICOL': 2, 'PIFL2': 3},
    #                 chm_mean=4.015508459469479,
    #                 chm_std=4.809300736115787,
    #                 lr=5e-4,
    #                 height_threshold=5,
    #                 class_weights=[0.64344262, 0.74056604, 1.35344828, 2.80357143],
    #                 trained_backbone=True,
    #                 features_dict={
    #                     'pca' : 3,
    #                     'ica': 3,
    #                     'raw_bands': 15
    #                 },
    #                 num_intermediate_classes = 256,
    #                 pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
    #                 train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_training',
    #                 valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_valid',
    #                 test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/our_labels_3_3/label_test',
    #                 pre_training_epochs = 15,
    #                 refine_epochs = 200,
    #                 pre_train_batch_size = 2048,
    #                 refine_batch_size = 32,
    #                 pre_train_workers = 8,
    #                 refine_workers = 1,
    #                 log_dir='exp_logs/',
    #                 pre_training=False,
    #                 extra_labels='our_no_schedule_augment',
    #                 augment_refine=True,
    #                 scheduler=False)

    

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'azm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'shadow': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'chm': 1,
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca' : 10,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')


# #ICA
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')
                    
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'azm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'shadow': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                         'azm': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'chm': 1,
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica' : 10,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')
# #RAW

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')
                    
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'azm': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'shadow': 1,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'raw_bands' : 15,
#                         'azm': 1, 
#                         'shadow': 1, 
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')


# #COMBOS
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'ica': 10,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_') 

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica': 10,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'ica': 10,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'ica': 3,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'ica': 3,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')     

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'ica': 3,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')      

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'raw_bands' : 15,
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_') 

#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 10,
#                         'ica': 10,
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1,
#                         'shadow': 1
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')   
    
#     unified_training(class_key={'PIEN': 0, 'ABLAL': 1, 'PIFL2': 2, 'PICOL': 3},
#                     chm_mean=4.015508459469479,
#                     chm_std=4.809300736115787,
#                     lr=5e-4,
#                     height_threshold=5,
#                     class_weights=[0.59090909, 0.85526316, 2.70833333, 1.3 ],
#                     trained_backbone=True,
#                     features_dict={
#                         'pca': 3,
#                         'ica': 3,
#                         'raw_bands' : 15,
#                         'chm': 1,
#                         'azm': 1,
#                         'shadow': 1
#                     },
#                     num_intermediate_classes = 256,
#                     pre_train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/raw_training/',
#                     train_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_training',
#                     valid_folder = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_valid',
#                     test_folder  = 'C:/Users/tonyt/Documents/Research/datasets/tensors/niwo_2020_pca_ica_shadow_extra_all/hybrid_labels_3_3/label_test',
#                     pre_training_epochs = 15,
#                     refine_epochs = 200,
#                     pre_train_batch_size = 2048,
#                     refine_batch_size = 32,
#                     pre_train_workers = 8,
#                     refine_workers = 1,
#                     log_dir='exp_logs/',
#                     pre_training=False,
#                     extra_labels='hybrid_')   